<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><meta name="generator" content="Gatsby 5.13.7"/><meta name="theme-color" content="#663399"/><style data-href="/styles.5250b878f8ec5a9f94b0.css" data-identity="gatsby-global-css">body{background-color:#f5f5f5;color:#333;font-family:Roboto,sans-serif;margin:0;padding:0}a{color:#007acc;text-decoration:none}a:hover{text-decoration:underline}h1,h2,h3,h4,h5,h6{font-family:Montserrat,sans-serif}button{font-family:Poppins,sans-serif}.markdown-body{background:#fff;border-radius:8px;box-shadow:0 2px 4px rgba(0,0,0,.1);font-family:Roboto,sans-serif;line-height:1.6;margin:2rem 0;padding:2rem}.markdown-body blockquote{border-left:.25em solid #dfe2e5;color:#6a737d;margin:0;padding:0 1em}.markdown-body pre{background-color:#f6f8fa;border-radius:8px;overflow:auto;padding:16px}.markdown-body code{background:rgba(27,31,35,.05);border-radius:3px;padding:.2em .4em}.markdown-body pre code{white-space:pre-wrap;word-break:break-word}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{font-weight:700;margin-bottom:1rem;margin-top:1.5rem}.markdown-body p{margin-bottom:1rem}.markdown-body a{word-wrap:break-word;overflow-wrap:break-word;word-break:break-word}</style><style data-styled="" data-styled-version="5.3.11">.fSgxj{max-width:700px;margin:0 auto;padding:0 20px;}/*!sc*/
data-styled.g1[id="Container-sc-16528bm-0"]{content:"fSgxj,"}/*!sc*/
.dolPew{background:#f0f0f0;padding:0.5rem;text-align:center;font-size:0.8rem;border-top:1px solid #ccc;font-family:'Lato',sans-serif;}/*!sc*/
data-styled.g2[id="Footer__FooterContainer-sc-z09s33-0"]{content:"dolPew,"}/*!sc*/
.ijVxnH{color:#007BFF;-webkit-text-decoration:none;text-decoration:none;}/*!sc*/
.ijVxnH:hover{-webkit-text-decoration:underline;text-decoration:underline;}/*!sc*/
data-styled.g3[id="Footer__FooterLink-sc-z09s33-1"]{content:"ijVxnH,"}/*!sc*/
.eravZ{font-size:2.5rem;margin:0.5rem 0 0.5rem 0;}/*!sc*/
data-styled.g5[id="blog-post__PostTitle-sc-1iu9sol-0"]{content:"eravZ,"}/*!sc*/
.kXOzhE{font-size:1rem;color:#666;margin-bottom:1rem;}/*!sc*/
data-styled.g6[id="blog-post__PostDate-sc-1iu9sol-1"]{content:"kXOzhE,"}/*!sc*/
.irwwWE{display:inline-block;margin-bottom:0.5rem;padding:0.3rem 0.6rem;background-color:#6a9b86;color:white;-webkit-text-decoration:none;text-decoration:none;border-radius:3px;font-size:0.875rem;font-weight:normal;}/*!sc*/
.irwwWE:hover{background-color:#005fa3;}/*!sc*/
data-styled.g7[id="blog-post__AllPostsButton-sc-1iu9sol-2"]{content:"irwwWE,"}/*!sc*/
</style><link rel="icon" href="/favicon-32x32.png?v=b2dec66daa6289e2a332fc74ed123411" type="image/png"/><link rel="manifest" href="/manifest.webmanifest" crossorigin="anonymous"/><link rel="apple-touch-icon" sizes="48x48" href="/icons/icon-48x48.png?v=b2dec66daa6289e2a332fc74ed123411"/><link rel="apple-touch-icon" sizes="72x72" href="/icons/icon-72x72.png?v=b2dec66daa6289e2a332fc74ed123411"/><link rel="apple-touch-icon" sizes="96x96" href="/icons/icon-96x96.png?v=b2dec66daa6289e2a332fc74ed123411"/><link rel="apple-touch-icon" sizes="144x144" href="/icons/icon-144x144.png?v=b2dec66daa6289e2a332fc74ed123411"/><link rel="apple-touch-icon" sizes="192x192" href="/icons/icon-192x192.png?v=b2dec66daa6289e2a332fc74ed123411"/><link rel="apple-touch-icon" sizes="256x256" href="/icons/icon-256x256.png?v=b2dec66daa6289e2a332fc74ed123411"/><link rel="apple-touch-icon" sizes="384x384" href="/icons/icon-384x384.png?v=b2dec66daa6289e2a332fc74ed123411"/><link rel="apple-touch-icon" sizes="512x512" href="/icons/icon-512x512.png?v=b2dec66daa6289e2a332fc74ed123411"/><link href="https://fonts.googleapis.com/css?family=Roboto:400,700|Montserrat:400,700|Poppins:400,700&amp;display=swap" rel="stylesheet"/><script data-goatcounter="https://sunghj1118.goatcounter.com/count" async="" src="//gc.zgo.at/count.js"></script></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><div class="Container-sc-16528bm-0 fSgxj"><div class="markdown-body"><a class="blog-post__AllPostsButton-sc-1iu9sol-2 irwwWE" href="/">&lt; All posts</a><h1 class="blog-post__PostTitle-sc-1iu9sol-0 eravZ">2차 모의고사 기출문제</h1><p class="blog-post__PostDate-sc-1iu9sol-1 kXOzhE">November 10, 2024</p><div><h1>2차 모의고사 기출문제</h1>
<ol>
<li>Take a backup of the etcd cluster and save it to /opt/etcd-backup.db.</li>
</ol>
<p><code>export ETCDCTL_API=3</code>
<code>cat /etc/kubernetes/manifests/etcd.yaml | grep file</code></p>
<pre><code class="language-bash">ETCDCTL_API=3 etcdctl --endpoints 127.0.0.1:2379 snapshot save /opt/etcd-backup.db \
> --cacert=/etc/kubernetes/pki/etcd/ca.crt \
> --cert=/etc/kubernetes/pki/etcd/server.crt \
> --key=/etc/kubernetes/pki/etcd/server.key
</code></pre>
<ol>
<li>Create a Pod called redis-storage with image: redis:alpine with a Volume of type emptyDir that lasts for the life of the Pod.</li>
</ol>
<p>Specs on the below.</p>
<ul>
<li>Pod named 'redis-storage' created</li>
<li>Pod 'redis-storage' uses Volume type of emptyDir</li>
<li>Pod 'redis-storage' uses volumeMount with mountPath = /data/redis</li>
</ul>
<pre><code class="language-yaml">apiVersion: v1
kind: Pod
metadata:
  name: redis-storage
spec:
  containers:
  - name: redis-storage
    image: redis:alpine
    volumeMounts:
      - mountPath: /data/redis
        name: redis-storage-volume
  volumes:
  - name: redis-storage-volume
    emptyDir: {}
</code></pre>
<ol start="3">
<li>Create a new pod called super-user-pod with image busybox:1.28. Allow the pod to be able to set system_time.</li>
</ol>
<p>The container should sleep for 4800 seconds.<br>
Pod: super-user-pod<br>
Container Image: busybox:1.28<br>
Is SYS_TIME capability set for the container?</p>
<pre><code class="language-yaml">apiVersion: v1
kind: Pod
metadata:
  name: super-user-pod
spec:
  containers:
  - name: super-user-container
    image: busybox:1.28
    command: ["sleep", "4800"]
    securityContext:
      capabilities:
        add: ["SYS_TIME"]
</code></pre>
<ol start="4">
<li>A pod definition file is created at /root/CKA/use-pv.yaml. Make use of this manifest file and mount the persistent volume called pv-1. Ensure the pod is running and the PV is bound.</li>
</ol>
<ul>
<li>mountPath: /data</li>
<li>persistentVolumeClaim Name: my-pvc</li>
<li>persistentVolume Claim configured correctly</li>
<li>pod using the correct mountPath</li>
<li>pod using the persistent volume claim?</li>
</ul>
<p>step1: create PVC to bind with PV</p>
<p><code>vim pvc.yaml</code></p>
<pre><code class="language-yaml">apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: my-pvc
spec:
  accessModes:
    - ReadWriteOnce
  volumeMode: Filesystem
  resources:
    requests:
      storage: 10Mi
</code></pre>
<p><code>kubectl apply -f pvc.yaml</code></p>
<p>step2: edit existing pod yaml file to use PVC</p>
<pre><code class="language-yaml">apiVersion: v1
kind: Pod
metadata:
  creationTimestamp: null
  labels:
    run: use-pv
  name: use-pv
spec:
  containers:
  - image: nginx
    name: use-pv
    resources: {}
    volumeMounts:
    - mountPath: "/data"
      name: mypd
  volumes:
  - name: mypd
    persistentVolumeClaim:
      claimName: my-pvc
  dnsPolicy: ClusterFirst
  restartPolicy: Always
status: {}
</code></pre>
<p><code>kubectl apply -f /root/CKA/use-pv.yaml</code></p>
<p><code>kubectl get pvc my-pvc</code></p>
<p><code>kubectl get pod use-pv</code></p>
<ol start="5">
<li>Create a new deployment called nginx-deploy, with image nginx:1.16 and 1 replica. Next upgrade the deployment to version 1.17 using rolling update.</li>
</ol>
<ul>
<li>Deployment : nginx-deploy. Image: nginx:1.16</li>
<li>Image: nginx:1.16</li>
<li>Task: Upgrade the version of the deployment to 1:17</li>
<li>Task: Record the changes for the image upgrade</li>
</ul>
<ol>
<li>Create a deployment with image nginx:1.16 and 1 replica</li>
</ol>
<p><code>kubectl create deployment nginx-deploy --image=nginx:1.16 --replicas=1</code></p>
<ol start="2">
<li>Upgrade the deployment to version 1.17</li>
</ol>
<p><code>kubectl set image deployment/nginx-deploy nginx=nginx:1.17 --record</code></p>
<ol start="6">
<li>Create a new user called john. Grant him access to the cluster. John should have permission to create, list, get, update and delete pods in the development namespace . The private key exists in the location: /root/CKA/john.key and csr at /root/CKA/john.csr.</li>
</ol>
<ul>
<li>Important Note: As of kubernetes 1.19, the CertificateSigningRequest object expects a signerName.</li>
<li>Please refer the documentation to see an example. The documentation tab is available at the top right of terminal.</li>
<li>CSR: john-developer Status:Approved</li>
<li>Role Name: developer, namespace: development, Resource: Pods</li>
<li>Access: User 'john' has appropriate permissions</li>
</ul>
<p>Steps:</p>
<ol>
<li>
<p>Create a Certificate Signing Request (CSR)</p>
</li>
<li>
<p>Approve the CSR</p>
</li>
<li>
<p>Create a Role</p>
</li>
<li>
<p>Create a RoleBinding</p>
</li>
<li>
<p>Generate a kubeconfig file for John</p>
</li>
<li>
<p>Create a CSR for john</p>
</li>
</ol>
<p>step 1: create CSR</p>
<pre><code class="language-bash">cat &#x3C;&#x3C; EOF | kubectl apply -f -
apiVersion: certificates.k8s.io/v1
kind: CertificateSigningRequest
metadata:
  name: john-developer
spec:
  request: $(cat /root/CKA/john.csr | base64 | tr -d '\n')
  signerName: kubernetes.io/kube-apiserver-client
  usages:
  - client auth
EOF
</code></pre>
<p>step 2: approve CSR<br>
<code>kubectl certificate approve john-developer</code></p>
<p>step 3: create role<br>
<code>kubectl create role developer --verb=create,list,get,update,delete --resource=pods -n development</code></p>
<p>step 4: create rolebinding<br>
<code>kubectl create rolebinding john-developer --role=developer --user=john -n development</code></p>
<p>step 5: generate kubeconfig file for john<br>
<code>kubectl get csr john-developer -o jsonpath='{.status.certificate}' | base64 -d > john.crt</code></p>
<p>TO_VERIFY:</p>
<pre><code class="language-bash">kubectl auth can-i create pods --as=john -n development
kubectl auth can-i list pods --as=john -n development
kubectl auth can-i get pods --as=john -n development
kubectl auth can-i update pods --as=john -n development
kubectl auth can-i delete pods --as=john -n development
</code></pre>
<ol start="7">
<li>Create a nginx pod called nginx-resolver using image nginx, expose it internally with a service called nginx-resolver-service. Test that you are able to look up the service and pod names from within the cluster. Use the image: busybox:1.28 for dns lookup. Record results in /root/CKA/nginx.svc and /root/CKA/nginx.pod</li>
</ol>
<ul>
<li>Pod: nginx-resolver created</li>
<li>Service DNS Resolution recorded correctly</li>
<li>Pod DNS resolution recorded correctly</li>
</ul>
<p>모르겠다. 계속 틀린다. pod랑 service를 bash로 temp busybox 하나 만들어서 보려고 하는데 이게 아닌것 같다.</p>
<p><strong>끝나고 풀이를 보니까 다음과 같다:</strong></p>
<p>step 1:</p>
<ul>
<li>Use the command kubectl run and create a nginx pod and busybox pod. Resolve it, nginx service and its pod name from busybox pod.</li>
<li>To create a pod nginx-resolver and expose it internally:</li>
</ul>
<p><code>kubectl run nginx-resolver --image=nginx</code><br>
<code>kubectl expose pod nginx-resolver --name=nginx-resolver-service --port=80 --target-port=80 --type=ClusterIP</code></p>
<p>step 2:<br>
To create a pod test-nslookup. Test that you are able to look up the service and pod names from within the cluster:</p>
<p><code>kubectl run test-nslookup --image=busybox:1.28 --rm -it --restart=Never -- nslookup nginx-resolver-service</code><br>
<code>kubectl run test-nslookup --image=busybox:1.28 --rm -it --restart=Never -- nslookup nginx-resolver-service > /root/CKA/nginx.svc</code></p>
<p>step 3:<br>
Get the IP of the nginx-resolver pod and replace the dots(.) with hyphon(-) which will be used below.</p>
<p><code>kubectl get pod nginx-resolver -o wide</code><br>
<code>kubectl run test-nslookup --image=busybox:1.28 --rm -it --restart=Never -- nslookup &#x3C;P-O-D-I-P.default.pod> > /root/CKA/nginx.pod</code></p>
<ol start="8">
<li>Create a static pod on node01 called nginx-critical with image nginx and make sure that it is recreated/restarted automatically in case of a failure.</li>
</ol>
<ul>
<li>Use /etc/kubernetes/manifests as the Static Pod path for example.</li>
<li>static pod configured under /etc/kubernetes/manifests ?</li>
<li>Pod nginx-critical-node01 is up and running</li>
</ul>
<p>답:</p>
<ul>
<li><code>ssh node01</code></li>
<li><code>mkdir /etc/kubernetes/manifests</code></li>
<li><code>cd /etc/kubernetes/manifests</code></li>
<li><code>vim nginx-critical.yaml</code></li>
<li><code>kubectl get pods -o wide | grep nginx-critical</code></li>
</ul>
<h2>마무리</h2>
<p>1번 모의고사보다 어렵다. 이런 식으로 나오면 당황할 것 같다. 더 열심히 공부해야겠다.</p></div></div></div><footer class="Footer__FooterContainer-sc-z09s33-0 dolPew"><p>© <!-- -->2024<!-- --> HyunJoon Sung. All Rights Reserved.</p><p><a href="https://github.com/sunghj1118" class="Footer__FooterLink-sc-z09s33-1 ijVxnH">GitHub</a></p></footer></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/kubernetes/CKA/cka-mock2/";/*]]>*/</script><!-- slice-start id="_gatsby-scripts-1" -->
          <script
            id="gatsby-chunk-mapping"
          >
            window.___chunkMapping="{\"app\":[\"/app-2a748b101fc84366569c.js\"],\"component---src-pages-404-js\":[\"/component---src-pages-404-js-60d2a0d2c248384ad0d2.js\"],\"component---src-pages-index-js\":[\"/component---src-pages-index-js-593ef84ffd916dd56b25.js\"],\"component---src-pages-page-2-js\":[\"/component---src-pages-page-2-js-50e83426ef775361f1a0.js\"],\"component---src-pages-projects-js\":[\"/component---src-pages-projects-js-09d84881e2521f783e15.js\"],\"component---src-pages-using-ssr-js\":[\"/component---src-pages-using-ssr-js-f4952d7ab534af96aca0.js\"],\"component---src-pages-using-typescript-tsx\":[\"/component---src-pages-using-typescript-tsx-55e14b7949e0e0236a5b.js\"],\"component---src-templates-blog-post-js\":[\"/component---src-templates-blog-post-js-a5dcc9dbff974058c7d9.js\"],\"component---src-templates-tag-js\":[\"/component---src-templates-tag-js-84a93951c485ea92cc02.js\"]}";
          </script>
        <script>window.___webpackCompilationHash="885ecb13b1d4f4b10784";</script><script src="/webpack-runtime-a14314fed5ac8e7c9263.js" async></script><script src="/framework-a880249783d1bea64870.js" async></script><script src="/app-2a748b101fc84366569c.js" async></script><!-- slice-end id="_gatsby-scripts-1" --></body></html>